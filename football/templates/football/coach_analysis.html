{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>{{ section_title }} · Cuerpo técnico</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body {
        margin: 0;
        font-family: 'Inter', system-ui, sans-serif;
        background: linear-gradient(180deg, #020417 0%, #050b1c 100%);
        color: #f8fafc;
      }
      .page {
        max-width: 1100px;
        margin: 0 auto;
        padding: 2rem 1.25rem 3rem;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 1.5rem;
      }
      header h1 {
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 0.15em;
      }
      header p {
        margin: 0;
        color: rgba(226, 232, 240, 0.7);
      }
      .panel {
        background: rgba(15, 23, 42, 0.95);
        border-radius: 24px;
        padding: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.55);
      }
      .grid {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        margin-top: 1rem;
      }
      .item-wide {
        grid-column: span 2;
      }
      @media (max-width: 900px) {
        .item-wide {
          grid-column: auto;
        }
      }
      .item {
        padding: 1rem;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(15, 23, 42, 0.8);
        min-height: 110px;
      }
      .item h3 {
        margin: 0 0 0.4rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-size: 0.9rem;
      }
      .item p {
        margin: 0;
        color: rgba(226, 232, 240, 0.8);
      }
      .button {
        border-radius: 999px;
        padding: 0.7rem 1.4rem;
        border: none;
        background: linear-gradient(135deg, #facc15, #f97316);
        font-weight: 700;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        cursor: pointer;
      }
      .ghost {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.18);
        color: #f8fafc;
      }
      .form {
        margin-top: 1.5rem;
        display: grid;
        gap: 0.8rem;
      }
      label {
        font-size: 0.85rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.7);
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 0.8rem 0.9rem;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: rgba(2, 6, 23, 0.55);
        color: #e2e8f0;
        font-size: 0.95rem;
        appearance: none;
      }
      textarea {
        min-height: 180px;
        resize: vertical;
      }
      .actions {
        display: flex;
        gap: 0.8rem;
        justify-content: flex-end;
        margin-top: 0.5rem;
      }
      .error {
        color: #fca5a5;
        margin-top: 0.5rem;
      }
      .list {
        margin: 0;
        padding: 0;
        list-style: none;
      }
      .list li {
        padding: 0.35rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }
      .meta {
        color: rgba(226, 232, 240, 0.7);
        font-size: 0.85rem;
      }
      .lineup-field {
        position: relative;
        border-radius: 18px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: #0b1b0f;
        min-height: 420px;
      }
      .lineup-field img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      .lineup-player {
        position: absolute;
        transform: translate(-50%, -50%);
        text-align: center;
        white-space: nowrap;
      }
      .lineup-badge {
        width: 28px;
        height: 28px;
        border-radius: 999px;
        background: rgba(2, 6, 23, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.25);
        color: #f8fafc;
        display: grid;
        place-items: center;
        font-size: 0.7rem;
        font-weight: 700;
        letter-spacing: 0.04em;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
      }
      .lineup-name {
        margin-top: 0.2rem;
        font-size: 0.72rem;
        font-weight: 600;
        color: #f8fafc;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7);
      }
      .pos-gk { left: 50%; top: 88%; }
      .pos-lb { left: 18%; top: 72%; }
      .pos-cb { left: 50%; top: 72%; }
      .pos-rcb { left: 62%; top: 72%; }
      .pos-lcb { left: 38%; top: 72%; }
      .pos-rb { left: 82%; top: 72%; }
      .pos-dm { left: 50%; top: 58%; }
      .pos-lm { left: 26%; top: 55%; }
      .pos-cm { left: 50%; top: 50%; }
      .pos-rm { left: 74%; top: 55%; }
      .pos-am { left: 50%; top: 40%; }
      .pos-lw { left: 22%; top: 32%; }
      .pos-st { left: 50%; top: 28%; }
      .pos-rw { left: 78%; top: 32%; }
      .pos-unknown { left: 50%; top: 50%; }
      .lineup-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
        color: rgba(226, 232, 240, 0.7);
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      .lineup-meta strong {
        color: #facc15;
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <div>
          <p>Área técnica · Cuerpo técnico</p>
          <h1>{{ section_title }}</h1>
        </div>
        <a class="button ghost" href="{% url 'coach-detail' %}">Volver</a>
      </header>
      <article class="panel">
        <p>{{ description }}</p>
        <form class="form" method="post">
          {% csrf_token %}
          <div>
            <label for="team_id">Equipo rival</label>
            <select id="team_id" name="team_id">
              <option value="">Selecciona un equipo</option>
              {% for team in teams %}
              <option value="{{ team.id }}" {% if team_id|stringformat:"s" == team.id|stringformat:"s" %}selected{% endif %}>
                {{ team.name }}
              </option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label for="team_url">URL del rival (opcional)</label>
            <input id="team_url" name="team_url" type="text" value="{{ team_url }}" />
          </div>
          <div>
            <label for="raw_text">Pega aquí el texto/HTML de LaPreferente</label>
            <textarea id="raw_text" name="raw_text">{{ raw_text }}</textarea>
          </div>
          <div class="actions">
            <button class="button" type="submit">Analizar rival</button>
          </div>
          {% if error %}
          <p class="error">{{ error }}</p>
          {% endif %}
        </form>
        {% if roster %}
        <div class="grid">
          <div class="item item-wide">
            <h3>11 probable</h3>
            <div class="lineup-meta">
              <span>Formación estimada</span>
              <strong>{{ formation }}</strong>
            </div>
            <div class="lineup-field">
              <img src="{% static 'football/campo-futbol.jpg' %}" alt="Campo de fútbol" />
              {% for player in probable_eleven %}
                {% with pos=player.position|lower %}
                  {% if 'portero' in pos %}
                    <span class="lineup-player pos-gk">
                      <span class="lineup-badge">GK</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'lateral izquierdo' in pos %}
                    <span class="lineup-player pos-lb">
                      <span class="lineup-badge">LI</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'lateral derecho' in pos %}
                    <span class="lineup-player pos-rb">
                      <span class="lineup-badge">LD</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'central' in pos and 'izq' in pos %}
                    <span class="lineup-player pos-lcb">
                      <span class="lineup-badge">CI</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'central' in pos and 'der' in pos %}
                    <span class="lineup-player pos-rcb">
                      <span class="lineup-badge">CD</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'central' in pos %}
                    <span class="lineup-player pos-cb">
                      <span class="lineup-badge">C</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'pivote' in pos %}
                    <span class="lineup-player pos-dm">
                      <span class="lineup-badge">MC</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'medio centro' in pos %}
                    <span class="lineup-player pos-cm">
                      <span class="lineup-badge">MC</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'interior izquierdo' in pos %}
                    <span class="lineup-player pos-lm">
                      <span class="lineup-badge">MI</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'interior derecho' in pos %}
                    <span class="lineup-player pos-rm">
                      <span class="lineup-badge">MD</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'media punta' in pos %}
                    <span class="lineup-player pos-am">
                      <span class="lineup-badge">MP</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'extremo izquierdo' in pos %}
                    <span class="lineup-player pos-lw">
                      <span class="lineup-badge">EI</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'extremo derecho' in pos %}
                    <span class="lineup-player pos-rw">
                      <span class="lineup-badge">ED</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'delantero centro' in pos %}
                    <span class="lineup-player pos-st">
                      <span class="lineup-badge">DC</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% elif 'delantero' in pos %}
                    <span class="lineup-player pos-st">
                      <span class="lineup-badge">DC</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% else %}
                    <span class="lineup-player pos-unknown">
                      <span class="lineup-badge">?</span>
                      <span class="lineup-name">{{ player.name }}</span>
                    </span>
                  {% endif %}
                {% endwith %}
              {% endfor %}
            </div>
          </div>
          <div class="item">
            <h3>Máximos goleadores</h3>
            <ul class="list">
              {% for player in insights.top_scorers %}
              <li>
                <strong>{{ player.name }}</strong>
                <span class="meta">· {{ player.goals }} goles · {{ player.minutes }} min</span>
              </li>
              {% endfor %}
            </ul>
          </div>
          <div class="item">
            <h3>Más minutos</h3>
            <ul class="list">
              {% for player in insights.most_minutes %}
              <li>
                <strong>{{ player.name }}</strong>
                <span class="meta">· {{ player.minutes }} min · {{ player.position }}</span>
              </li>
              {% endfor %}
            </ul>
          </div>
          <div class="item">
            <h3>Más tarjetas</h3>
            <ul class="list">
              {% for player in insights.most_cards %}
              <li>
                <strong>{{ player.name }}</strong>
                <span class="meta">· {{ player.yellow_cards }}A · {{ player.red_cards }}R</span>
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
        {% endif %}
      </article>
    </div>
  </body>
</html>
